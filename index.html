<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Badgey</title>
  <link rel="icon" type="image/png" sizes="192x192" href="/spudz_free.png" />
  <link rel="apple-touch-icon" href="/spudz_free.png" />
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Inter', 'Segoe UI', sans-serif;
      background: #ffffff;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 2.5rem;
      padding: 2rem;
    }

    .logo-container {
      position: relative;
      cursor: pointer;
      -webkit-user-select: none;
      user-select: none;
    }

    #spudzCanvas {
      width: 180px;
      height: 180px;
      transition: transform 0.1s ease;
    }

    .logo-container:active #spudzCanvas {
      transform: scale(0.95);
    }

    .ow-text {
      position: absolute;
      top: -10px;
      right: -20px;
      font-size: 1.5rem;
      font-weight: 700;
      color: #f84979;
      opacity: 0;
      transform: rotate(12deg);
      pointer-events: none;
      transition: opacity 0.1s ease;
    }

    .ow-text.show {
      opacity: 1;
    }

    .buttons {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      justify-content: center;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      text-decoration: none;
      color: #ffffff;
      background: #f84979;
      padding: 0.875rem 2.5rem;
      border-radius: 999px;
      font-weight: 600;
      font-size: 1rem;
      transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;
      box-shadow: 0 4px 16px rgba(248, 73, 121, 0.3);
    }

    .btn:hover {
      background: #d63c66;
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(248, 73, 121, 0.4);
    }

    .btn-secondary {
      background: #f4f4f5;
      color: #3e3e3e;
      border: 1px solid #d4d4d8;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.12);
    }

    .btn-secondary:hover {
      background: #e4e4e7;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
    }

    @media (max-width: 480px) {
      #spudzCanvas {
        width: 140px;
        height: 140px;
      }

      .buttons {
        flex-direction: column;
        width: 100%;
        max-width: 280px;
      }

      .btn {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="logo-container" id="logoContainer">
    <canvas id="spudzCanvas" width="180" height="180" aria-label="Badgey" role="img"></canvas>
    <span class="ow-text" id="owText">OW!</span>
  </div>

  <div class="buttons">
    <a href="https://go.badgey.org" class="btn">Go</a>
    <a href="https://flashcards.badgey.org" class="btn btn-secondary">Flashcards</a>
  </div>

  <script>
    // --- TUNABLE CONSTANTS ---
    const RANGE_PX = 250;
    const SMOOTHING_ALPHA = 0.15;
    const IDLE_DRIFT_MIN_MS = 2000;
    const IDLE_DRIFT_MAX_MS = 4000;
    const IDLE_DRIFT_RANGE = 2;
    const WINCE_DURATION_MS = 500;
    const SPRITESHEET_SCALE = 1.1;

    // --- SPRITESHEET CONSTANTS ---
    const SPRITE_COLS = 8;
    const SPRITE_ROWS = 10;
    const SPRITE_CELL_SIZE = 512;

    // --- DOM ELEMENTS ---
    const canvas = document.getElementById('spudzCanvas');
    const ctx = canvas.getContext('2d');
    const owText = document.getElementById('owText');
    const logoContainer = document.getElementById('logoContainer');

    // --- STATE ---
    let state = 'idle_follow';
    let smoothedDx = 0;
    let smoothedDy = 0;
    let targetDx = 0;
    let targetDy = 0;
    let hasMouseActivity = false;
    let idleDriftTimeout = null;
    let winceTimeout = null;

    // --- IMAGE PRELOADING ---
    const images = { spritesheet: null, idle: null, wince: null };
    let imagesLoaded = 0;
    const TOTAL_IMAGES = 3;

    function preloadImages() {
      const srcs = {
        spritesheet: '/spudz_eyez_4096x5120.png',
        idle: '/spudz_free.png',
        wince: '/spudz_free_OW.png'
      };
      for (const [key, src] of Object.entries(srcs)) {
        const img = new Image();
        img.onload = () => {
          images[key] = img;
          imagesLoaded++;
          if (imagesLoaded === TOTAL_IMAGES) startAnimationLoop();
        };
        img.src = src;
      }
    }

    function resizeCanvas() {
      const rect = canvas.getBoundingClientRect();
      const dpr = window.devicePixelRatio || 1;
      canvas.width = rect.width * dpr;
      canvas.height = rect.height * dpr;
      ctx.scale(dpr, dpr);
    }

    function clamp(val, min, max) {
      return Math.max(min, Math.min(max, val));
    }

    function getGridIndices(dx, dy) {
      const col = Math.round(((dx + 1) / 2) * (SPRITE_COLS - 1));
      const row = Math.round(((dy + 1) / 2) * (SPRITE_ROWS - 1));
      return {
        col: clamp(col, 0, SPRITE_COLS - 1),
        row: clamp(row, 0, SPRITE_ROWS - 1)
      };
    }

    function scheduleIdleDrift() {
      if (idleDriftTimeout) clearTimeout(idleDriftTimeout);
      const delay = IDLE_DRIFT_MIN_MS + Math.random() * (IDLE_DRIFT_MAX_MS - IDLE_DRIFT_MIN_MS);
      idleDriftTimeout = setTimeout(() => {
        if (!hasMouseActivity && state === 'idle_follow') {
          const offsetCol = (Math.random() - 0.5) * 2 * IDLE_DRIFT_RANGE;
          const offsetRow = (Math.random() - 0.5) * 2 * IDLE_DRIFT_RANGE;
          targetDx = clamp(offsetCol / (SPRITE_COLS / 2), -0.4, 0.4);
          targetDy = clamp(offsetRow / (SPRITE_ROWS / 2), -0.4, 0.4);
        }
        scheduleIdleDrift();
      }, delay);
    }

    function resetToCenter() {
      targetDx = 0;
      targetDy = 0;
    }

    let mouseActivityTimeout = null;

    function handleMouseMove(e) {
      if (state !== 'idle_follow') return;
      hasMouseActivity = true;
      if (mouseActivityTimeout) clearTimeout(mouseActivityTimeout);
      mouseActivityTimeout = setTimeout(() => {
        hasMouseActivity = false;
        resetToCenter();
      }, 3000);

      const rect = canvas.getBoundingClientRect();
      const centerX = rect.left + rect.width / 2;
      const centerY = rect.top + rect.height / 2;
      const dx = e.clientX - centerX;
      const dy = e.clientY - centerY;
      targetDx = clamp(dx / RANGE_PX, -1, 1);
      targetDy = clamp(dy / RANGE_PX, -1, 1);
    }

    function handleMouseLeave() {
      hasMouseActivity = false;
      resetToCenter();
    }

    function render() {
      const displayWidth = canvas.getBoundingClientRect().width;
      const displayHeight = canvas.getBoundingClientRect().height;
      ctx.clearRect(0, 0, displayWidth, displayHeight);

      if (state === 'wince' && images.wince) {
        ctx.drawImage(images.wince, 0, 0, displayWidth, displayHeight);
      } else if (images.spritesheet) {
        const { col, row } = getGridIndices(smoothedDx, smoothedDy);
        const sx = col * SPRITE_CELL_SIZE;
        const sy = row * SPRITE_CELL_SIZE;
        const scaledW = displayWidth * SPRITESHEET_SCALE;
        const scaledH = displayHeight * SPRITESHEET_SCALE;
        const offsetX = (displayWidth - scaledW) / 2;
        const offsetY = (displayHeight - scaledH) / 2;
        ctx.drawImage(
          images.spritesheet,
          sx, sy, SPRITE_CELL_SIZE, SPRITE_CELL_SIZE,
          offsetX, offsetY, scaledW, scaledH
        );
      } else if (images.idle) {
        ctx.drawImage(images.idle, 0, 0, displayWidth, displayHeight);
      }
    }

    function animationLoop() {
      smoothedDx += (targetDx - smoothedDx) * SMOOTHING_ALPHA;
      smoothedDy += (targetDy - smoothedDy) * SMOOTHING_ALPHA;
      render();
      requestAnimationFrame(animationLoop);
    }

    function startAnimationLoop() {
      resizeCanvas();
      scheduleIdleDrift();
      animationLoop();
    }

    logoContainer.addEventListener('click', () => {
      state = 'wince';
      owText.classList.add('show');
      if (winceTimeout) clearTimeout(winceTimeout);
      winceTimeout = setTimeout(() => {
        state = 'idle_follow';
        owText.classList.remove('show');
      }, WINCE_DURATION_MS);
    });

    document.addEventListener('mousemove', handleMouseMove);
    document.addEventListener('mouseleave', handleMouseLeave);
    window.addEventListener('resize', resizeCanvas);

    preloadImages();
  </script>
</body>
</html>
